

	<script type="text/javascript">
		reX.ResourceManager.setCSS(['css/media.css']);
	
		var scrolllist;
	
		reX.state.events = {
			domready: function() {						
				mediaManager.getAll(reX.state.section.key ,function(sec) {
					reX.state.section.json = sec;
					
					var j2h = new reX.json2html({
						html: '<span>{@title}</span>'
					});
					
					var menu = new reX.Menu(j2h.convert(reX.state.section.json));
					menu.build();
				});
			},
			
			menuDone: function(event) {	
				scrolllist = new reX.Scrolllist('nav', {offset:3});
				
				reX.state.controls.select(1);
				window.fireEvent('selectionChange', reX.state.controls.getSelection());
			},
		
			selectionChange: function(item) {
				var i = item.getProperty('idx');
                reX.debug('selecting ' + reX.state.section.json[i]['@key'] + ' with type ' + reX.state.section.json[i]['@type'], REX_DEBUG);

	
				var j2h = new reX.json2html({
					html: '<div class="poster"><img src="http://localhost:32400'+mediaManager.transcodeImage(reX.state.section.json[i]['@thumb'])+'"></div>' +
                            '<div class="metadata">'+
                                '<div class="flag resolution_flag">{@videoResolution}</div>'+
                                '<div class="flag ratio_flag">{@aspectRatio}</div>'+
                                '<div class="flag video_flag">{@videoCodec}</div>'+
                                '<div class="flag audio_flag">{@audioCodec}</div>'+
                                '<div class="flag channel_flag">{@audioChannels}</div>'+
                                '<div class="releasedAt">{@originallyAvailableAt}</div>'+
                                '<div class="year">{@year}</div>'+
                                '<div class="rating">{@rating}</div>'+
                                '<p class="tagline">{@tagline}</p>' +
								'<p class="summary">{@summary}</p>' +
							'</div>'
							
				});
				
				var html = j2h.convert(Object.merge(reX.state.section.json[i], reX.state.section.json[i].Media));			
				$('skin').set('html', html);
				
				j2h = new reX.json2html({
					html: '<div class="fanart"><img src="http://localhost:32400'+mediaManager.transcodeImage(reX.state.section.json[i]['@art'])+'"></div>'
				});
				
				html = j2h.convert(reX.state.section.json[i]);			
				$('background').set('html', html);
	
			},
			
			selectionEnter: function(item) {
                var i = item.getProperty('idx');
				reX.debug('entering ' + reX.state.section.json[i]['@title'] + ' with key ' + reX.state.section.json[i]['@key'] + ' and type ' + reX.state.section.json[i]['@type'], REX_DEBUG);
				switch (reX.state.section.json[i]['@type']) {
					case 'movie': 
                    case 'episode': 
                        reX.debug('trying to play "' + reX.state.section.json[i]['@title'] +'"', REX_DEBUG);
                        reX.debug(JSON.encode(reX.state.section.json[i].Media), REX_DEBUG);
                        
                        // get video file
                        if (reX.state.section.json[i].Media.Part[0] == undefined) {
                            file = reX.state.section.json[i].Media.Part["@file"]
                        }
                        else {
                            file = reX.state.section.json[i].Media.Part[0]["@file"];
                        }
                        
                        reX.debug(file+' -- '+reX.state.section.json[i]["@key"], REX_DEBUG);
                        Player.playVideo(file, reX.state.section.json[i]["@key"]);
                        break;
                        
					case 'show': 
                        reX.load('seasons.html',reX.state.section.json[i]['@key']);
                        break;
                } 
			},
			
			pressedDown: function(item) {
				scrolllist.seekNext();
			},
			
			pressedUp: function(item) {
				scrolllist.seekPrev();
			}
		};

		window.addEvents(reX.state.events);
	</script>


	<div id="background">
	</div>
	<div class="band"></div>
	<div id="outerskin">
		<div id="skin"></div>
	</div>