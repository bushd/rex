<script type="text/javascript">    
    reX.ResourceManager.setCSS( skinManager.getCurrentSkinForSection().css.split(',') );

    var scrolllist, metadata;

    reX.state.events = {
        domready: function() {	
        },
        
        menuDone: function(event) {	
            scrolllist = new reX.Scrolllist('nav', {offset:3});
            
            reX.state.controls.select(1);
            window.fireEvent('selectionChange', reX.state.controls.getSelection());
        },
    
        selectionChange: function(item) {
            var i = item.getProperty('idx');
            reX.debug('selecting ' + reX.state.section.json[i]['@key'] + ' with type ' + reX.state.section.json[i]['@type'], REX_DEBUG);

            metadata.options.substitute = Object.merge(reX.state.section.json[i], reX.state.section.json[i].Media);
            metadata.parse();

            var j2h = new reX.json2html({
                html: '<img src="http://localhost:32400'+mediaManager.transcodeImage(reX.state.section.json[i]['@thumb'])+'">'
            });
            
            var html = j2h.convert(Object.merge(reX.state.section.json[i], reX.state.section.json[i].Media));			
            $('poster').set('html', html);
                        
            j2h = new reX.json2html({
                html: '<div class="fanart"><img src="http://localhost:32400'+mediaManager.transcodeImage(reX.state.section.json[i]['@art'])+'"></div>'
            });
            
            html = j2h.convert(reX.state.section.json[i]);			
            $('background').set('html', html);

        },
        
        selectionEnter: function(item) {
            var i = item.getProperty('idx');
            reX.debug('entering ' + reX.state.section.json[i]['@title'] + ' with key ' + reX.state.section.json[i]['@key'] + ' and type ' + reX.state.section.json[i]['@type'], REX_DEBUG);
            switch (reX.state.section.json[i]['@type']) {
                case 'movie': 
                case 'episode': 
                    reX.debug('trying to play "' + reX.state.section.json[i]['@title'] +'"', REX_DEBUG);
                    reX.debug(JSON.encode(reX.state.section.json[i].Media), REX_DEBUG);
                    
                    // get video file
                    if (reX.state.section.json[i].Media.Part[0] == undefined) {
                        file = reX.state.section.json[i].Media.Part["@file"]
                    }
                    else {
                        file = reX.state.section.json[i].Media.Part[0]["@file"];
                    }
                    
                    reX.debug(file+' -- '+reX.state.section.json[i]["@key"], REX_DEBUG);
                    Player.playVideo(file, reX.state.section.json[i]["@key"]);
                    break;
                    
                case 'show': 
                    reX.load('seasons.html',reX.state.section.json[i]['@key']);
                    break;
            } 
        },
        
        pressedDown: function(item) {
            scrolllist.seekNext();
        },
        
        pressedUp: function(item) {
            scrolllist.seekPrev();
        }
    };

    window.addEvents(reX.state.events);
    
    mediaManager.getAll(reX.state.section.key ,function(sec) {
                reX.state.section.json = sec;
                                
                var path = skinManager.getCurrentSkinForSection().path; 
                                
                new Skin({
                    templateURL: path + skinManager.getCurrentSkinForSection().templates.skin, //'skins/movie/default/template.default.html',
                    update: 'inner'
                });
                
                metadata = new Template({
                    templateURL: path + skinManager.getCurrentSkinForSection().templates.metadata, //'skins/movie/default/template.default.html',
                    update: 'skin'
                });
                                
                var menu = new reX.Menu({
                    templateURL: path + skinManager.getCurrentSkinForSection().templates.navigation, //'skins/movie/default/navigation.default.html',
                    sectionObject: reX.state.section.json
                });
                                
                menu.generateElements();
                menu.build();
            });

</script>